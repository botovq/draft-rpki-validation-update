   There are two inputs to the validation algorithm:

   1.  a trust anchor

   2.  a certificate to be validated

   The algorithm is initialized with two new variables for use in the
   RPKI: Verified Resource Set-IP (VRS-IP) and Verified Resource Set-AS
   (VRS-AS).  These sets are used to track the set of INRs (IP address
   space and AS numbers) that are considered valid for each CA
   certificate.  The VRS-IP and VRS-AS sets are initially set to the IP
   Address Delegation and AS Identifier Delegation values, respectively,
   from the trust anchor used to perform validation.

   This path validation algorithm verifies, among other things, that a
   prospective certification path (a sequence of n certificates)
   satisfies the following conditions:

   a.  for all 'x' in {1, ..., n-1}, the subject of certificate 'x' is
       the issuer of certificate ('x' + 1);

   b.  certificate '1' is issued by a trust anchor;

   c.  certificate 'n' is the certificate to be validated; and

   d.  for all 'x' in {1, ..., n}, certificate 'x' is valid.

   Certificate validation requires verifying that all of the following
   conditions hold, in addition to the certification path validation
   criteria specified in Section 6 of [RFC5280].

   1.  The signature of certificate x (x>1) is verified using the public
       key of the issuer's certificate (x-1), using the signature
       algorithm specified for that public key (in certificate x-1).

   2.  The current time lies within the interval defined by the
       NotBefore and NotAfter values in the Validity field of
       certificate x.

   3.  The Version, Issuer, and Subject fields of certificate x satisfy
       the constraints established in Sections 4.1 to 4.7 of RFC 6487.

   4.  If certificate x uses the Certificate Policy defined in
       Section 4.8.9 of [RFC6487], then the certificate MUST contain all
       extensions defined in Section 4.8 of [RFC6487] that must be
       present.  The value(s) for each of these extensions MUST satisfy
       the constraints established for each extension in the respective
       sections.  Any extension not thus identified MUST NOT appear in
       certificate x.

   5.  If certificate x uses the Certificate Policy defined in
       Section 4.2.4.1, then all extensions defined in Section 4.8 of
       [RFC6487], except Sections 4.8.9, 4.8.10, and 4.8.11 MUST be
       present.  The certificate MUST contain an extension as defined in
       Sections 4.2.4.2 or 4.2.4.3, or both.  The value(s) for each of
       these extensions MUST satisfy the constraints established for
       each extension in the respective sections.  Any extension not
       thus identified MUST NOT appear in certificate x.

   6.  Certificate x MUST NOT have been revoked, i.e., it MUST NOT
       appear on a Certificate Revocation List (CRL) issued by the CA
       represented by certificate x-1.

   7.  Compute the VRS-IP and VRS-AS set values as indicated below:

       *  If the IP Address Delegation extension is present in
          certificate x and x=1, set the VRS-IP to the resources found
          in this extension.

       *  If the IP Address Delegation extension is present in
          certificate x and x>1, set the VRS-IP to the intersection of
          the resources between this extension and the value of the
          VRS-IP computed for certificate x-1.

       *  If the IP Address Delegation extension is absent in
          certificate x, set the VRS-IP to NULL.

       *  If the IP Address Delegation extension is present in
          certificate x and x=1, set the VRS-IP to the resources found
          in this extension.

       *  If the AS Identifier Delegation extension is present in
          certificate x and x>1, set the VRS-AS to the intersection of
          the resources between this extension and the value of the
          VRS-AS computed for certificate x-1.

       *  If the AS Identifier Delegation extension is absent in
          certificate x, set the VRS-AS to NULL.

   8.  If there is any difference in resources in the VRS-IP and the IP
       Address Delegation extension on certificate x, or the VRS-AS and
       the AS Identifier Delegation extension on certificate x, then:

       *  If certificate x uses the Certificate Policy defined in
          Section 4.2.4.1, a warning listing the overclaiming resources
          for certificate x SHOULD be issued.

       *  If certificate x uses the Certificate Policy defined in
          Section 4.8.9 of [RFC6487], then certificate x MUST be
          rejected.

   These rules allow a CA certificate to contain resources that are not
   present in (all of) the certificates along the path from the trust
   anchor to the CA certificate.  If none of the resources in the CA
   certificate are present in all certificates along the path, no
   subordinate certificates could be valid.  However, the certificate is
   not immediately rejected as this may be a transient condition.  Not
   immediately rejecting the certificate does not result in a security
   problem because the associated VRS sets accurately reflect the
   resources validly associated with the certificate in question.

4.2.5.  An Alternative ROA Validation

   Section 4 of [RFC6482] currently has the following text on the
   validation of resources on a ROA:

      The IP address delegation extension [RFC3779] is present in the
      end-entity (EE) certificate (contained within the ROA), and each
      IP address prefix(es) in the ROA is contained within the set of IP
      addresses specified by the EE certificate's IP address delegation
      extension.

   If the end entity certificate uses the Certificate Policy defined in
   Section 4.2.4.1, then the following approach must be used instead.

      The amended IP Address Delegation extension described in
      Section 4.2.4.2 is present in the end entity (EE) certificate
      (contained within the ROA), and each IP address prefix(es) in the
      ROA is contained within the VRS-IP set that is specified as an
      outcome of EE certificate validation described in Section 4.2.4.4.

   Note that this ensures that ROAs can be valid only if all IP address
   prefixes in the ROA are encompassed by the VRS-IP of all certificates
   along the path to the trust anchor used to verify it.

   Operators MAY issue separate ROAs for each IP address prefix, so that
   the loss of one or more IP address prefixes from the VRS-IP of any
   certificate along the path to the trust anchor would not invalidate
   authorizations for other IP address prefixes.
